name: generate Jokes

on:
  # run automatically every 24 hours
  schedule:
    - cron: "0 */24 * * *" 
  
  # allows to manually run the job at any time
  workflow_dispatch:
  

jobs:
  get-joke:
    runs-on: ubuntu-latest
    steps:
      - name: Make API request
        uses: actions/http-client@v2
        with:
          url: https://api.openai.com/v1/engines/davinci-codex/completions
          method: POST
          headers: |
            Authorization: Bearer ${{ secrets.OPEN_AI_API_KEY }}
            Content-Type: application/json
          body: |
            {
              "prompt": "3 jokes related to software enginnering. put in JS array",
              "max_tokens": 20,
              "n": 1,
              "stop": "\n"
            }
          output-file: response.json
      
      - name: Parse response
        run: echo $(jq -r '.data[0].text' response.json)
