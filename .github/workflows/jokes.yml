name: generate Jokes

on:
  # run automatically every 24 hours
  schedule:
    - cron: "0 */24 * * *" 
  
  # allows to manually run the job at any time
  workflow_dispatch:
  

jobs:
  generate-jokes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Docker environment
        uses: docker/setup-docker@v2
      - name: Generate jokes and save to file
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          docker run -i openai/cli /bin/bash -c "openai api completions.create -e davinci-codex -d '{\"prompt\":\"3 jokes related to software engineering. Put them in a JS array.\", \"temperature\":0.5, \"max_tokens\":50, \"n\":1, \"stop\":\"\\n\"}' > jokes.json && cat jokes.json | jq -r '.choices[].text' > jokes.txt"
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Add jokes to jokes.txt"
          commit_options: '--no-verify --signoff'
